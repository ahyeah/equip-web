using EquipDAL.Interface;
using EquipModel.Entities;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
namespace EquipDAL.Implement
{
    public class Person_Infos : BaseDAO,IPerson_Infos
    {

        public Person_Info GetPerson_info(int id)
        {
            try
            {
                using (var db = base.NewDB())
                {
                    return db.Persons.Where(a => a.Person_Id == id).First();
                }
            }
            catch (Exception e)
            { return null; }
        }
       public  Person_Info GetPerson_info(string Person_Name)
        {
            try { 
            using (var db = base.NewDB())
            {
                return db.Persons.Where(a => a.Person_Name == Person_Name ).First();
            }
                }
           catch(Exception e)
            { return null; }
       }

       public  List<Role_Info> GetPerson_Roles(int id)
       {
           using (var db = base.NewDB())
           {
               var P= db.Persons.Where(a => a.Person_Id ==id ).First();
               return P.Person_roles.ToList();
           }

           
        }

        public List<Equip_Info> GetPerson_Equips(int id)
        {
            using (var db = base.NewDB())
            {
                var P = db.Persons.Where(a => a.Person_Id == id).First();
                return P.Person_Equips.ToList();
            }
        
        }

       public  Depart_Archi GetPerson_Depart(int id)
        {   using (var db = base.NewDB())
            {
            var P = db.Persons.Where(a => a.Person_Id == id).First();
            return P.Dept_Belong;
           }
        }

       public bool AddRole(int Person_id, int Role_id)
       {
           using (var db = base.NewDB())
           {
               try
               {
                   var P = db.Persons.Where(a => a.Person_Id == Person_id).First();
                   var PR = db.Roles.Where(a => a.Role_Id == Role_id).First();
                   P.Person_roles.Add(PR);
                   db.SaveChanges();
                   return true;
               }
               catch
               {
                   return false;
               }
           }

       }
       public bool AddEquip(int Person_id, int Equip_id)
       {
           using (var db = base.NewDB())
           {
               try
               {
                   var P = db.Persons.Where(a => a.Person_Id == Person_id).First();
                   var E= db.Equips.Where(a => a.Equip_Id == Equip_id).First();
                   P.Person_Equips.Add(E);
                   db.SaveChanges();
                   return true;
               }
               catch
               {
                   return false;
               }
           }

       }
       public  bool AddPerson_info(Person_Info New_Person)
        {
            try
            {
                using (var db = base.NewDB())
                {
                    db.Persons.Add(New_Person);

                    db.SaveChanges();
                    return true;
                }
              }
                catch
                {
                    return false;
                }
             
           
        
        }
       public  bool DeletePerson_info(int id) 
        {
            using (var db = base.NewDB())
            {
                try
                {
                    var P = db.Persons.Where(a => a.Person_Id == id).First();
                    if (P == null)
                        return false;
                    else
                    {
                        P.Person_roles.Clear();
                        db.Persons.Remove(P);
                        db.SaveChanges();
                        return true;

                    }
                }
                catch { return false; }
            }
        
        }

       public  bool ModifyPerson_info(int id, Person_Info New_Person)
        {
            using (var db = base.NewDB())
            {
                try
                {
                    var P = db.Persons.Where(a => a.Person_Id == id).First();
                    if (P == null)
                        return false;
                    else
                    {
                        P.Person_Name=New_Person.Person_Name;
                        P.Person_Pwd = New_Person.Person_Pwd;
                        P.Person_tel = New_Person.Person_tel;
                        P.Person_mail = New_Person.Person_mail;
                        db.SaveChanges();
                        return true;

                    }
                }
                catch { return false; }
            }
        
        }
    }
   
}
