using EquipModel.Entities;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace EquipDAL.Implement
{
   public  class Roles : BaseDAO
    {
        //获取拥有指定角色的用户信息列表
        public List<Person_Info> getRole_Persons(int Role_id)
        {
            using (var db = base.NewDB())
            {
                var R = db.Roles.Where(a => a.Role_Id==Role_id).First();
                return R.Role_Persons.ToList();
            }
        }

       //获取所有的角色
        public List<Role_Info> getRoles()
        {
            using (var db = base.NewDB())
            {
                var R = db.Roles.ToList();
                return R;
            }
        }
       //获取某制定角色对应的系统菜单
       public List<Menu> getRole_Menus(int Role_id)
        {
            using (var db = base.NewDB())
            {
                var R = db.Roles.Where(a=>a.Role_Id==Role_id).First().Role_Menus.ToList();
                return R;
            }
        }
        //给特定的角色添加用户

        public bool AddPerson(int  Role_id,int  Person_id )
        {
            using (var db = base.NewDB())
            {
                try
                {
                   
                    var PR = db.Roles.Where(a => a.Role_Id == Role_id).First();
                    var P = db.Persons.Where(a => a.Person_Id == Person_id).First();
                    PR.Role_Persons.Add(P);
                    db.SaveChanges();
                    return true;
                }
                catch
                {
                    return false;
                }
            }

        }
        //添加一个新的角色
        public bool AddRole(Role_Info New_Role)
        {
            using(var db=base.NewDB())
            {
                try
                {                 
                    db.Roles.Add(New_Role);
                    db.SaveChanges();
                    return true;
                }
                catch
                {
                    return false;
                }
            }

        }

        
        //删除某一个已定义的角色 
        public bool DeleteRole(int roleId)
        {
            using (var db = base.NewDB())
            {
                try
                {
                    var r = db.Roles.Where(a => a.Role_Id == roleId).First();
                    if (r == null)
                        return false;
                    else
                    {  //foreach(var p in r.Role_Persons )
                       // { var person = db.Persons.Where(a => a.Person_Id == p.Person_Id).First();
                        //  person.Person_roles.Remove(person.Person_roles.Where(s => s.Role_Id == r.Role_Id).First());
                       // }

                        r.Role_Persons.Clear();
                        db.Roles.Remove(r);
                        db.SaveChanges();
                        return true;

                    }
                }
                catch { return false; }
            }
        }
        //修改某一个已定义的角色
        public bool ModifyRole(int roleId, Role_Info New_Role)
        {

            using (var db = base.NewDB())
            {
                try
                {
                    var r = db.Roles.Where(a => a.Role_Id == roleId).First();
                    if (r == null)
                        return false;
                    else
                    {
                        r.Role_Name = New_Role.Role_Name;
                        r.Role_Desc = New_Role.Role_Desc;
                        db.SaveChanges();
                        return true;

                    }
                }
                catch { return false; }
            }
        }
    }
    
}
